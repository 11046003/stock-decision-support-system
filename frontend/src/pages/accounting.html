<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
  <style>
    @import url(//fonts.googleapis.com/earlyaccess/notosanstc.css);

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Poppins', 'Helvetica', 'Arial', 'Noto Sans TC', '黑體-繁', '微軟正黑體', sans-serif !important;
      box-sizing: border-box;
    }

    * {
      box-sizing: border-box;
    }

    .nav-link {
      color: #C0C2C6;
      font-size: 15px;
    }

    .nav-link:hover {
      color: #ffffff;
    }

    #btnb:hover {
      background-color: rgba(1, 198, 183, 80%);
    }

    .kv {
      height: 100vh;
    }

    .larger-text {
      font-size: 3em;
    }

    .container-all {
      display: flex;
      align-items: stretch;
      height: calc(100% - 56px); /* 減去 navbar 的高度 */
    }

    /* 以下是側拉式選單 */
    #sliderbar {
      width: 250px;
      height: 100%;
      background-color: #464e68;
      color: white;
      transition: margin-left 0.3s;
    }

    .collapse-btn {
      position: relative;
      top: 1%;
      left: 195px;
      background-color: #464e68;
      color: white;
      border: none;
      font-size: 30px;
    }

    .collapse-btn:hover {
      background-color: antiquewhite;
      transition: 0.4s;
    }

    #sliderbar ul li a {
      margin-left: -20px;
      padding: 10px;
      font-size: 20px;
      display: block;
      text-decoration: none;
      color: white;
    }

    #sliderbar ul li a:hover {
      color: antiquewhite;
      background: skyblue;
    }

    #sliderbar.active {
      margin-left: -200px;
    }

    .list-unstyled {
      padding: 30px;
    }

    .container-right {
      background-image: url(images/background-pink.png);
      background-size: cover;
      flex: 1;
      display: flex;
      flex-direction: row;
      padding: 20px;
      overflow-y: auto;
    }

    .container-right.collapsed {
      padding-left: 50px;
    }

    .account-form {
      flex: 2;
    }

    .account-form-container {
      margin: 20px;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      flex: 1;
    }

    .side-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .totalamounttitle {
      margin-top: 0;
      margin-left: -20px;
      font-size: 24px;
      color: #ffffff;
    }

    .totalamount {
      background-color: #f8f9fa;
      width: 180px;
      height: 100px;
      margin-top: 10px;
      margin-left: -20px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: #333;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .progress-container {
      margin-top: 20px;
      width: 100%;
      max-width: 500px;
      height: 100px;
      margin: 20px auto;
    }

    .progress-bar {
      height: 30px;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background-color: transparent;
      transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
    }

    .progress-button {
      display: block;
      margin-bottom: 15px;
    }

    .progress-label {
      font-size: 15px;
      padding-top: 10px;
    }

    #currentTotal {
      float: left;
    }

    #limitAmount {
      float: right;
    }

    .outertradehistory {
      width: 100%;
      max-width: 500px;
      height: 100%;
      max-height: 500px;
      margin: 20px auto;
      /* margin-top: 30px; */
      border: 2px solid #ccc;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .tradehistory-header {
      font-size: 25px;
      padding: 10px;
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 2px solid #ccc;
    }

    .table th, .table td {
      border: none;
      text-align: center;
      vertical-align: middle;
      background-color: transparent;
    }

    .table th {
      border-bottom: 2px solid #ccc;
    }

    #accountForm label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #333333;
    }

    #accountForm input[type="text"],
    #accountForm input[type="number"],
    #accountForm select,
    #accountForm textarea {
      width: 100%;
      border: 1px solid #cccccc;
      border-radius: 5px;
    }

    #accountForm input[type="text"]:focus,
    #accountForm input[type="number"]:focus,
    #accountForm select:focus,
    #accountForm textarea:focus {
      outline: none;
      border-color: #3498db;
    }

    #accountForm button[type="submit"] {
      background-color: #3498db;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    #accountForm button[type="submit"]:hover {
      background-color: #2980b9;
    }

    .category-wrapper, .payment-wrapper {
      display: flex;
      align-items: center;
    }

    .form-select {
      flex: 1;
      max-width: 150px !important;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      margin-left: 10px;
    }

    .type-wrapper {
      display: flex;
      align-items: center;
    }

    .type-wrapper input[type="radio"] {
      margin-right: 5px;
    }

    .type-wrapper label {
      margin-right: 20px;
    }


  </style>
</head>
<body>
  <div class="kv w-100">
    <nav class="navbar navbar-expand-lg" style="background-color: #060A1B">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" style="color: #C0C2C6;">
          <img src="./images/logo192.png" alt="" class="img-fluid" style="width: 30px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse d-flex justify-content-end" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item mx-4">
              <a class="nav-link" href="accounting v2.html">記帳</a>
            </li>
            <li class="nav-item mx-4">
              <a class="nav-link active" aria-current="page" href="/" style="color: #C0C2C6;">個股</a>
            </li>
            <li class="nav-item mx-4">
              <a class="nav-link" href="#">熱門成交股</a>
            </li>
            <li class="nav-item mx-4">
              <a class="nav-link" href="#">台灣五十股</a>
            </li>
            <li class="nav-item dropdown mx-4">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Dropdown link
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </li>
            <li class="nav-item mx-4" style="border: 1px solid #ffffff;">
              <a class="nav-link text-nowrap d-flex justify-content-center" id="btnb" href="#" style="width: 100px;height: 37px;color: white;">LOG IN</a>
            </li>
            <li class="nav-item mx-4" style="background-color: #424551;">
              <a class="nav-link text-nowrap d-flex justify-content-center" id="btnb" href="#" style="width: 200px;height: 38px;color: white;">CREATE ACCOUNT</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-all">
      <div class="container-left">
        <nav id="sliderbar">
          <button type="button" id="collapse" class="collapse-btn">
            <img src="images/list.webp" alt="" width="40px">
          </button>
          <ul class="list-unstyled">
            <h2 class="totalamounttitle">您的總資產</h2>
            <div class="totalamount">
              $ <span id="totalAmountDisplay">0.00</span>
            </div>
            <li>
              <a href="#">記帳</a>
            </li>
            <li>
              <a href="#sublist" data-bs-toggle="collapse" id="dropdown">報表查詢</a>
              <ul id="sublist" class="list-unstyled collapse">
                <li>
                  <a href="#">總資產</a>
                </li>
                <li>
                  <a href="#">當日資產</a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>

      <div class="container-right">
        <div class="account-form">
          <div class="account-form-container">
            <h2>記帳表格</h2>
            <form id="accountForm">
              <label for="date">日期：</label>
              <input type="text" id="date" name="date"><br><br>
              <label for="amount">金額：</label>
              <input type="number" id="amount" name="amount" pattern="[0-9]*" title="請輸入數字" required><br><br>
              <label for="category">類別：</label>
              <div class="category-wrapper">
                <select id="category" name="category" class="form-select">
                  <option value="飲食">飲食</option>
                  <option value="交通">交通</option>
                  <option value="娛樂">娛樂</option>
                  <option value="日常用品">日常用品</option>
                  <option value="水電瓦斯">水電瓦斯</option>
                  <option value="電話網路">電話網路</option>
                  <option value="服飾">服飾</option>
                  <option value="汽機車">汽機車</option>
                  <option value="醫療保險">醫療保險</option>
                </select>
                <button type="button" id="addCategoryBtn" class="btn btn-primary">新增類別</button>
                <button type="button" id="deleteCategoryBtn" class="btn btn-danger">刪除類別</button>
              </div><br>
              <label for="payment">支付方式：</label>
              <div class="payment-wrapper">
                <select id="payment" name="payment" class="form-select">
                  <option value="現金">現金</option>
                  <option value="信用卡">信用卡</option>
                  <option value="電子支付">電子支付</option>
                  <option value="金融卡">金融卡</option>
                </select>
                <button type="button" id="addPaymentBtn" class="btn btn-primary">新增支付方式</button>
                <button type="button" id="deletePaymentBtn" class="btn btn-danger">刪除支付方式</button>
              </div><br>
              <label for="description">描述/備註：</label><br>
              <textarea id="description" name="description" rows="4" cols="50"></textarea><br><br>
              <div class="type-wrapper">
                <label for="type">類型：</label>
                <input type="radio" id="income" name="type" value="income" checked>
                <label for="income">收入</label>
                <input type="radio" id="expense" name="type" value="expense">
                <label for="expense">支出</label>
              </div>
              <br><br>
              <button type="submit">提交</button>
            </form>
          </div>
        </div>
        <div class="side-content">
          <div class="progress-container">
            <button class="progress-button" onclick="setLimit()">設定上限</button>
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="currentTotal" class="progress-label">目前總資產：$0.00</div>
            <div id="limitAmount" class="progress-label">上限：$3000.00</div>
          </div>
          <div class="outertradehistory" id="outerTradeHistory">
            <div class="tradehistory-header">最近交易</div>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">類型</th>
                  <th scope="col">日期</th>
                  <th scope="col">類別</th>
                  <th scope="col">支付方式</th>
                  <th scope="col">金額</th>
                </tr>
              </thead>
              <tbody id="tradeHistoryBody">
                <!-- 交易記錄將插入到這裡 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 彈出視窗的 HTML -->
  <div class="modal fade" id="congratsModal" tabindex="-1" aria-labelledby="congratsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="congratsModalLabel">恭喜</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          恭喜達到投資金額額度！
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    flatpickr("#date", {
      // 在此處設置 Flatpickr 的選項（可選）
    });

    // 獲取表單元素
    const form = document.getElementById('accountForm');
    // 獲取顯示總資產的元素
    const totalAmountDisplay = document.getElementById('totalAmountDisplay');
    const progressBar = document.getElementById('progressFill');
    const outerTradeHistory = document.getElementById('outerTradeHistory');
    const tradeHistoryBody = document.getElementById('tradeHistoryBody');
    const currentTotalElement = document.getElementById('currentTotal');
    const limitAmountElement = document.getElementById('limitAmount');
    const congratsModal = new bootstrap.Modal(document.getElementById('congratsModal'));
    const maxTrades = 5; // 最多顯示5筆交易

    // 初始總資產
    let totalAmount = 0;
    let limit = 3000; // 預設上限

    // 初始顯示總資產和上限
    updateTotalAmount();
    updateLimitAmount();

    // 監聽表單提交事件
    form.addEventListener('submit', function(event) {
      event.preventDefault(); // 阻止默認表單提交行為

      // 獲取表單中的金額和收入/支出選擇
      const dateInput = document.getElementById('date');
      const formAmountInput = document.getElementById('amount'); // 修改為 formAmountInput
      const formAmount = parseFloat(formAmountInput.value); // 修改為 formAmount
      const type = document.querySelector('input[name="type"]:checked').value;

      // 檢查日期是否已選擇
      if (!dateInput.value) {
        alert('請選擇日期');
        return;
      }

      // 檢查金額是否為空或者是否包含非數字字符
      if (isNaN(formAmount) || formAmount <= 0) {
        alert('金額欄位請輸入正數');
        return;
      }

      // 根據收入/支出選擇更新總資產
      if (type === 'income') {
        totalAmount += formAmount; // 修改為 formAmount
      } else if (type === 'expense') {
        totalAmount -= formAmount; // 修改為 formAmount
      }

      // 更新總資產顯示
      updateTotalAmount(); // 更新目前總資產數字
      totalAmountDisplay.textContent = totalAmount.toFixed(2); // 顯示到小數點後兩位

      // 獲取表單中的日期、金額和類別值
      const date = dateInput.value;
      const amount = formAmountInput.value; // 修改為 formAmountInput
      const category = document.getElementById('category').value;
      const payment = document.getElementById('payment').value;

      // 更新交易記錄
      updateTradeHistory(type, date, category, payment, amount);

      // 清空表單欄位
      form.reset();

      updateProgressBar();
    });

    function setLimit() {
      const newLimit = prompt('請輸入新的上限');
      if (!isNaN(newLimit) && newLimit > 0) {
        limit = parseFloat(newLimit);
        updateLimitAmount(); // 更新上限數字
        updateProgressBar(); // 更新進度條
      } else {
        alert('請輸入正確的數字');
      }
    }

    function updateTotalAmount() {
      currentTotalElement.textContent = '目前總資產：$' + totalAmount.toFixed(2);
    }

    function updateLimitAmount() {
      limitAmountElement.textContent = '最低投資金額：$' + limit.toFixed(2);
    }

    function updateProgressBar() {
      const progress = Math.min((totalAmount / limit) * 100, 100);
      progressBar.style.width = progress + '%';
      if (totalAmount >= limit) {
        congratsModal.show(); // 顯示彈出視窗
      }
      if (totalAmount <= 0) {
        progressBar.style.backgroundColor = 'transparent'; // 無顏色填充
      } else {
        progressBar.style.backgroundColor = '#3498db'; // 淺藍色
      }
    }

    function updateTradeHistory(type, date, category, payment, amount) {
      // 創建一個新的表格行
      const transactionRow = document.createElement('tr');

      // 根據收入/支出類型設置類型顯示文字
      const typeText = type === 'income' ? '收入' : '支出';

      // 設置每個單元格的內容
      transactionRow.innerHTML = `
        <td>${typeText}</td>
        <td>${date}</td>
        <td>${category}</td>
        <td>${payment}</td>
        <td>${amount}</td>
      `;

      // 將新交易行添加到表格的最上方
      tradeHistoryBody.insertBefore(transactionRow, tradeHistoryBody.firstChild);

      // 檢查交易記錄數量，超過最大值則刪除最舊的一筆
      if (tradeHistoryBody.childElementCount > maxTrades) {
        tradeHistoryBody.removeChild(tradeHistoryBody.lastChild);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const categorySelect = document.getElementById('category');
      const addCategoryBtn = document.getElementById('addCategoryBtn');
      const deleteCategoryBtn = document.getElementById('deleteCategoryBtn');
      const paymentSelect = document.getElementById('payment');
      const addPaymentBtn = document.getElementById('addPaymentBtn');
      const deletePaymentBtn = document.getElementById('deletePaymentBtn');

      // 新增類別的點擊事件處理
      addCategoryBtn.addEventListener('click', function() {
        const newCategory = prompt('請輸入新的類別');
        if (newCategory && newCategory.trim() !== '') {
          const optionExists = Array.from(categorySelect.options).some(option => option.value === newCategory);
          if (!optionExists) {
            const newOption = document.createElement('option');
            newOption.value = newCategory;
            newOption.textContent = newCategory;
            categorySelect.insertBefore(newOption, categorySelect.options[categorySelect.options.length - 1]);
            categorySelect.value = newCategory;
          } else {
            alert('該類別已存在！');
          }
        }
      });

      // 刪除類別的點擊事件處理
      deleteCategoryBtn.addEventListener('click', function() {
        const selectedCategory = categorySelect.value;
        if (!["飲食", "交通", "娛樂", "日常用品", "水電瓦斯", "電話網路", "服飾", "汽機車", "醫療保險"].includes(selectedCategory)) {
          const confirmation = confirm(`確定要刪除類別 "${selectedCategory}" 嗎？`);
          if (confirmation) {
            categorySelect.remove(categorySelect.selectedIndex);
          }
        } else {
          alert('此類別不能被刪除！');
        }
      });

      // 新增支付方式的點擊事件處理
      addPaymentBtn.addEventListener('click', function() {
        const newPayment = prompt('請輸入新的支付方式');
        if (newPayment && newPayment.trim() !== '') {
          const optionExists = Array.from(paymentSelect.options).some(option => option.value === newPayment);
          if (!optionExists) {
            const newOption = document.createElement('option');
            newOption.value = newPayment;
            newOption.textContent = newPayment;
            paymentSelect.insertBefore(newOption, paymentSelect.options[paymentSelect.options.length - 1]);
            paymentSelect.value = newPayment;
          } else {
            alert('該支付方式已存在！');
          }
        }
      });

      // 刪除支付方式的點擊事件處理
      deletePaymentBtn.addEventListener('click', function() {
        const selectedPayment = paymentSelect.value;
        if (!["現金", "信用卡", "電子支付", "金融卡"].includes(selectedPayment)) {
          const confirmation = confirm(`確定要刪除支付方式 "${selectedPayment}" 嗎？`);
          if (confirmation) {
            paymentSelect.remove(paymentSelect.selectedIndex);
          }
        } else {
          alert('此支付方式不能被刪除！');
        }
      });
    });

    $(document).ready(function(){
      $("#collapse").on("click",function(){
          $("#sliderbar").toggleClass("active");
          $(".account-form-container").toggleClass("collapsed"); // 添加 collapsed 類以便在 CSS 中控制大小
      })
    });
  </script>
</body>
</html>
